---
title: 工作项目介绍
date: 2024-05-09 10:19:55
tags:
---

# 云雀低代码平台

## 项目简介
主要面向内部研发的一个低代码平台，目的是为了解决中后台场景的管理系统、配置管理和临时运营活动等需求，这类需求的特点就是对 UI 没有太大的定制，主要保证快速、稳定、低成本的实现。对于前端来说主要的好处是可以快速的得到一个存储和对应的 api，对于一些小的需求和探索性项目，能够在服务端人力不足的情况下快速上线；对于服务端来说主要的好处是通过在系统进行配置，连接到对应的 DB 后，就可以得到一个高可用、可扩展、带版本管理的前端页面，并且可以对数据进行整合发布对接 CDN，直接在线上使用。系统还提供了页面扩展、流程管理、接口转发、数据发布、站点搭建等能力，配合使用可以快速的实现一个站点。

## 难点
数据管理作为系统的核心的功能，它的难点在于在易用性和通用性之间取得平衡。为了服务端存量 DB 的接入，需要抹平各个 DB（Mongo/MySQL等）的字段差异和 CRUD 差异；为了满足前端快速上线页面和一定的 UI 定制诉求，需要提供页面扩展、定制数据处理、数据权限、审批等能力。

为了解决这个问题在前端和服务端之间抽出了两层：驱动层和 BFF 层。
- 驱动层主要负责抹平各个 DB 的差异，提供统一的 CRUD 语法
- BFF 层负责提供 OpenApi、数据权限、页面扩展等平台能力

为了满足用户的定制在 BFF 层将通用能力抽成了几个模块：数据发布、流程管理、接口转发、站点搭建、页面扩展。几个模块的功能如下：
- 数据发布：对数据管理里的数据进行处理，发布到 CDN、Redis 等渠道，提供版本管理能力。主要用于数据在其他地方需要高 QPS 消费/版本管理的场景
- 流程管理：可以基于原子操作组合得到一个流程流转的接口。如创建数据前需要审批，配置后就会得到一个带审批能力的接口
- 接口转发：通过在平台配置可以直接基于 RPC 生成一个 HTTP 接口
- 页面扩展：对于数据管理生成的默认页面，可以通过页面或JSON进行扩展
- 站点搭建：组合页面和菜单，提供一个独立的站点

## 项目结果
服务了今日头条、西瓜视频、抖音、懂车帝、星图、安全中心等多个业务线。

# REDoc 协同文档

## 项目简介
小红书内部的协同文档，我主要负责文档企微 H5 版本、电子表格和 H5 在自研 APP 内的使用体验。
- 企微 H5 版本：负责推动文档在企微内的落地，从之前只有两个按钮的落地页到可以在企微直接浏览文档内容。
- 电子表格：负责文档内电子表格插件体验相关的能力，包括性能优化、全局查找、全局冻结等；负责独立表格（采购石墨）整体的接入和平台化，负责独立表格权限体系接入和多端体验适配。
- 自研 App 端内体验：负责日历、文档内电子表格、独立表格在自研 APP 内的体验优化。负责日历的性能优化，通过 NSR、离线包、网络资源加载优化等手段实现了日历在端内秒开。

## 难点
文档内电子表格的体验优化，经常一个需求会牵扯到很多场景，这些场景又会引发对应协同场景的子场景。

拿电子表格全局冻结这个需求举例，全局冻结主要的场景就是用户在文档内电子表格冻结了行头列头，希望滚动的时候，冻结的行列一直在视图内。
难点是要实现文档和电子表格（Canvas）的双向滚动联动，即文档滚动需要触发电子表格滚动，电子表格内滚动（如跳转到某个单元格）的时候需要改变文档的滚动位置。在设计全局滚动过程中需要考虑表格行数较多时 Canvas 画布的上限（会影响绘制性能）、全局冻结后在查找的体现、冻结和取消冻结时协同方的表现、移动端适配等等。

最终实现提供了一个滚动代理的中间层，负责在文档和电子表格之间双向滚动 。大致思路为监听文档滚动，当电子表格充满滚动容器时，改变为 fixed 布局，然后滚动时触发电子表格内部的滚动。此时画布的高度为视窗的高度，而不是表格内容的实际高度，所以 Canvas 的最大宽高就是视图的宽高。

## 项目结果
补全了文档在 IM 端的场景；提高文档内电子表格的体验和性能，错误率由30%左右降到了0.2%左右，加载时间P80指标由5s左右降到了1.5s左右；日历、表格、文档在端内体验优化，日历表现最为明显，通过一系列的优化操作实现了秒开。
